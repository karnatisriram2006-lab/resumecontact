/**
 * Core Philosophy:
 * This ruleset enforces a "write-once, read-never" security model for client-side
 * operations for public users, but allows full access for authenticated admins.
 * Any user (including anonymous) can submit data, but only signed-in admin users
 * can read, update, or delete it via the admin dashboard.
 *
 * Data Structure:
 * - /resumeRequests: Stores resume submission forms.
 * - /contactMessages: Stores general contact form messages.
 *
 * Key Security Decisions:
 * - Public Submission: Any authenticated session (including anonymous sign-in) is
 *   permitted to create documents in a "drop-box" fashion.
 * - Admin-Only Management: All read, update, and delete operations are restricted
 *   to signed-in users, who are assumed to be administrators. This is enforced by
 *   requiring authentication for any action other than 'create'.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ------------------------------------------------------------------------
    // Helper Functions
    // ------------------------------------------------------------------------

    /**
     * Checks if the user is authenticated, including anonymous users.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    // ------------------------------------------------------------------------
    // Collection Rules
    // ------------------------------------------------------------------------

    /**
     * @description
     *   - Anyone can create a resume request.
     *   - Only signed-in admins can read or update (e.g., change status).
     *   - Deletion from the client is disallowed.
     */
    match /resumeRequests/{resumeRequestId} {
      allow read, update: if isSignedIn();
      allow create: if isSignedIn();
      allow delete: if false;
    }

    /**
     * @description
     *   - Anyone can create a contact message.
     *   - Only signed-in admins can read or delete messages.
     *   - Updates from the client are disallowed.
     */
    match /contactMessages/{contactMessageId} {
      allow read, delete: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if false;
    }
  }
}
